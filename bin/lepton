#!/usr/bin/php
<?php

require('sys/base.php');

class LeptonUtil extends ConsoleApplication {
	protected $arguments = 'h';
	function main($argc,$argv) {
		if ($this->getParameterCount() == 0) {
			$this->usage();
			return 1;
		}
		switch(strtolower($this->getParameter(0))) {
			case 'deploy':
				Console::writeLn("Deploying instance...");
				break;
			case 'initialize':
				Console::write("Single or Multi domain site? [S/m] "); $mode = Console::readLn();
				Console::write("  Base domain name (for routing): "); $dombase = Console::readLn();
			
				Console::write("Creating folder structure ... ");
				Console::status("app             ");
				usleep(50000);
				Console::status("app/config      ");
				usleep(50000);
				Console::status("app/controllers ");
				usleep(50000);
				Console::status("app/models      ");
				usleep(50000);
				Console::status("app/views       ");
				usleep(50000);
				Console::status("res             ");
				usleep(50000);
				Console::writeLn("Done            ");

				Console::write("Copying files ... ");
				Console::writeLn("39 of 39");

				Console::write("Checking configuration ... ");
				Console::writeLn("Ok");
				Console::write("Do you want a htconf too? [y/N] ");
				$w = Console::readLn();
				break;
			case 'export':
				Console::writeLn("Exporting site to archive...");
				break;
			case 'import':
				break;
			case 'config':
				Console::write("Reading configuration metadata ... ");
				Console::status('dbx           '); sleep(1);
				Console::status('dbx.db        '); sleep(1);
				Console::status('dbx.db.mysql  '); sleep(1);
				Console::writeLn('done          ');
				Console::writeLn("Parsing configuration file ... done");
				Console::writeLn("Preparing options ... done");
				break;
			case 'exception':
				throw new Exception("This is a new exception");
				break;
			default:
				$this->usage();
				return 1;
		}
		return 0;
	}
	function usage() {
		Console::writeLn('Usage:     %s [-options] action [arguments]', $this->getName());
		Console::writeLn();
		Console::writeLn('Options:   -q          Quiet, show no info');
		Console::writeLn('           -h          Show help');
		Console::writeLn('           -o file     Output file (when exporting)');
		Console::writeLn('           -i file     Input file (when importing)');
		Console::writeLn();
		Console::writeLn('Actions:   deploy      Deploy a lepton MVC structure in the current folder');
		Console::writeLn('           initialize  Initializes a new Lepton deployment');
		Console::writeLn('           scaffold    Scaffolds the database and imports any data');
		Console::writeLn('           export      Export the entire site into a .tgz file');
		Console::writeLn('           import      Import a site from a .tgz file');
		Console::writeLn('           config      Configure interactively');
	}
}

return Lepton::run('LeptonUtil');
