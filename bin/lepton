#!/usr/bin/php
<?php

define('APP_PATH', '../app');
require('sys/base.php');

ModuleManager::load('lepton.console.readline');
ModuleManager::load('lepton.base.cmd.*');

class LeptonUtil extends ConsoleApplication {
	protected $arguments = 'hi';
	function autocomplete($cmd) {
		$cmds = array(
		
		);
		$m = array();
		foreach($cmds as $c) {
			if (substr($c,0,strlen($cmd)) == $cmd) $m[] = $c;	
		}
		var_dump($m);
		return $m;
	}
	function interactiveMode() {
		while($cmds = Readline::read(__astr('\c{ltgreen lepton}\c{ltblue >} '))) {
			Console::write(__astr('\b{}'));
			$cmd = explode(" ",$cmds);
			switch($cmd[0]) {
				case 'exit':
				case 'quit':
					return;
					break;
				default:
					$this->doCommand($cmd);
			}
			Readline::addHistory($cmds);
		}
	}
	function doCommand($cmd) {
		foreach(config::get('lepton.cmd.actionhandlers') as $handler) {
			if (method_exists($handler,$cmd[0])) {
				call_user_func_array(array($handler,$cmd[0]), array_slice($cmd,1));
				return;
			}
		}
		Console::warn("No such command: %s", $cmd[0]);

	}
	function main($argc,$argv) {

		if ($this->hasArgument('i')) return $this->interactiveMode();

		if ($this->getParameterCount() == 0) {
			$this->usage();
			return 1;
		}

		$this->doCommand($this->getParameterSlice(0));

		return 0;
	}
	function usage() {
		Console::writeLn('Usage:     %s [-options] command [arguments]', $this->getName());
		Console::writeLn();
		Console::writeLn('Options:   -q          Quiet, show no info');
		Console::writeLn('           -h          Show help');
		Console::writeLn('           -o file     Output file (when exporting)');
		Console::writeLn('           -i file     Input file (when importing)');
		Console::writeLn();
		Console::writeLn('Actions:   Use \'help\' to see the actions available');
	}
}

return Lepton::run('LeptonUtil');
